<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="keywords" content="Radio">
<meta name="description" content="NO SOAP, RADIO">
<link rel="shortcut icon" type="image/png" href="themes/nosoapradio-theme/">
<title>{{ if .IsHome }}{{ site.Title }}{{ else }}{{ printf "%s | %s" .Title site.Title }}{{ end }}</title>
{{ partialCached "head/css.html" . }}
{{ partialCached "head/js.html" . }}
<script src="js/icecast-metadata-player-1.17.2.main.min.js"></script>
<script>
    async function fetchIcecastMetadata() {
    try {
        const response = await fetch('https://stream.no-soap.net/status-json.xsl'); // Update this URL to your actual Icecast server
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Data:', data);

        let nowPlaying = '';

        // Check if the source is an array (multiple streams) or an object (single stream)
        if (Array.isArray(data.icestats.source)) {
            nowPlaying = data.icestats.source[0].title || 'No metadata available';
        } else {
            nowPlaying = data.icestats.source.title || 'No metadata available';
        }

        // Separate title and artist
        let [songTitle, artistName] = nowPlaying.split(' - ');

        // Add quotes around the song title
        songTitle = `"${songTitle.trim()}"`;

        // Display both song title and artist name
        document.getElementById('metadata').textContent = `${songTitle} - ${artistName.trim()}`;
    } catch (error) {
        console.error('Error fetching Icecast metadata:', error);
        document.getElementById('metadata').textContent = 'Error loading metadata';
    }
}

// Fetch metadata every 10 seconds
setInterval(fetchIcecastMetadata, 10000);

// Initial fetch
fetchIcecastMetadata();

  </script>